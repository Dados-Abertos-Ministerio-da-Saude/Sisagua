# -*- coding: utf-8 -*-
"""Sisagua.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Gbdf-ImHmVKM0icsdqhr4kOgzaF0SGXi

# Realizando a conexão com o driver
"""

from google.colab import drive
drive.mount('/gdrive', force_remount=True)

# Commented out IPython magic to ensure Python compatibility.
# %cd '/gdrive/My Drive/PDFS'
# %ls

"""# Importando a base de dados"""

# Commented out IPython magic to ensure Python compatibility.
import zipfile
import pandas as pd
import time

# Realizando o download da base

dados = !wget --no-check-certificate https://sage.saude.gov.br/dados/sisagua/controle_mensal_parametros_basicos_2021.zip

# Pegando os CSV's que se encontravam zipados

with zipfile.ZipFile('controle_mensal_parametros_basicos_2021.zip',"r") as zip_ref:
    zip_ref.extractall("Sisagua")

time.sleep(20)

# %cd 'Sisagua'
# %ls

# Lendo o Dataframe

df = pd.read_csv('controle_mensal_parametros_basicos_2021.csv', encoding='latin_1',sep=';',decimal=',',
                 dtype={'Código IBGE':'object','CNPJ da Instituição':'object',r'CNPJ do escritório regional/local':'object'})

"""# Visão geral do formato das colunas"""

df.info()

"""# Contagem de valores nulos"""

df.isnull().astype(int).sum()

"""# Conferindo se existem 27 UF's"""

df['UF'].value_counts()

"""# Conferindo se as 5 regiões estão corretas"""

df['Região Geográfica'].value_counts()

"""# Número de municípios distintos presentes na base"""

df['Município'].value_counts().count()

"""# Conferindo se o Código IBGE está indexado corretamente"""

(df.drop_duplicates(subset ="Código IBGE", keep = 'last')['Código IBGE']).to_csv('new.csv', index=False)

"""Existem 31 códigos IBGE que não tiveram correspondência com a base disponibilizada pelo Ministério da saúde, sendo estes:

![image.png](data:image/png;base64,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)

Conferindo quais municipios são referentes os códigos do IBGE
"""

df[df['Código IBGE']=='530004'].head(1)

"""# Tipos de instituições presentes na base"""

df['Tipo da Instituição'].value_counts()

"""# Siglas das 66 instituições presentes no banco com suas respectivas frequências

Algumas siglas se encontram cortadas ou com presença de espaçamentos na sua escrita
"""

pd.options.display.max_rows=1000

df['Sigla da Instituição'].value_counts()

"""# Conferindo se existe nomes de instituições preenchidos como número"""

instituicao = list((df.drop_duplicates(subset ="Nome da Instituição", keep = 'last')['Nome da Instituição']))

import collections

frequencia = []

for i in range(0,len(instituicao)):
  try:
    result = instituicao[i].isdigit()
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Conferindo se possui string na variavel CNPJ"""

CNPJ = list((df.drop_duplicates(subset ="CNPJ da Instituição", keep = 'last')['CNPJ da Instituição']))

frequencia = []

for i in range(0,len(CNPJ)):
  try:
    result = isinstance(CNPJ[i], str)
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Analisando o tamanho dos CNPJ's"""

frequencia = []

for i in range(0,len(CNPJ)):
  try:
    result = sum(len(i) for i in CNPJ[i])
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Conferindo se o nome da instituição regional / local esta preenchido como string"""

instituicao = list((df.drop_duplicates(subset ="Nome do escritório regional/local", keep = 'last')['Nome do escritório regional/local']))

import collections

frequencia = []

for i in range(0,len(instituicao)):
  try:
    result = instituicao[i].isdigit()
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Conferindo se possui valores textuais na variavel CNPJ do escritório regional/local"""

CNPJ = list((df.drop_duplicates(subset ="CNPJ do escritório regional/local", keep = 'last')['CNPJ do escritório regional/local']))

frequencia = []

for i in range(0,len(CNPJ)):
  try:
    result = isinstance(CNPJ[i], str)
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Conferindo a frequência de caracteres na variável CNPJ do escritório regional/local"""

instituicao = list((df.drop_duplicates(subset ="CNPJ do escritório regional/local", keep = 'last')['CNPJ do escritório regional/local']))

import collections

frequencia = []

for i in range(0,len(instituicao)):
  try:
    result = instituicao[i].isdigit()
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Tipo da forma de abastecimento"""

df['Tipo da Forma de Abastecimento'].value_counts()

"""### Conferindo se tem nome preenchido apenas com números"""

instituicao = list((df.drop_duplicates(subset ="Nome da Forma de Abastecimento", keep = 'last')['Nome da Forma de Abastecimento']))

import collections

frequencia = []

for i in range(0,len(instituicao)):
  try:
    result = instituicao[i].isdigit()
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Análise do ano de referência"""

df['Ano de referência'].value_counts()

"""# Mês de referência"""

df['Mês de referência'].value_counts()

"""# Ponto de Monitoramento"""

df['Ponto de Monitoramento'].value_counts()

"""# Campo

Existem diferentes classificações na variável, sendo que algumas delas se encontram incompletas
"""

df['Campo'].value_counts()

"""# Valor"""

Valor = list((df.drop_duplicates(subset ="Valor", keep = 'last')['Valor']))

frequencia = []

for i in range(0,len(Valor)):
  try:
    result = isinstance(Valor[i], str)
    frequencia.append(result)
  except:
    print('Valor nulo encontrado')

counter=collections.Counter(frequencia)

print(counter)

"""# Realizando a busca pela chave primária"""

(df.groupby(['Código Forma de abastecimento', 'Município','Mês de referência','Ponto de Monitoramento','Tipo de Filtração','Parâmetro','Campo']).size()).value_counts()